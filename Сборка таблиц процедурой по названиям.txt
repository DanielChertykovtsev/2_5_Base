CREATE OR REPLACE FUNCTION public.select_time(year integer, month integer)
	RETURNS table(saledate date, product_id integer, sales_cnt integer, shop_name1 varchar)  
	LANGUAGE plpgsql
AS $function$
	DECLARE 
		temprow record;
		sql_string text;
	BEGIN
		FOR temprow IN SELECT shop_name AS sn, shop_table AS st FROM public.shops
		LOOP
		EXECUTE 'SELECT date, product_id, sales_cnt,''' || temprow.sn || ''' as shop_name from ' || temprow.st;
		RETURN NEXT;
		END LOOP;
    RETURN;
	END;
$function$

SELECT * FROM select_time(2023,12) 

compose>docker exec -it compose-db-1 psql -U postgres -W
